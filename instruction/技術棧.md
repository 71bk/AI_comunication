# 技術棧（Tech Stack）— GPT-like 全端聊天網頁（A → B）

> 專案目標：先完成 A（MVP：類 ChatGPT 串流聊天），再無痛升級 B（RAG：文件問答＋引用）  
> 特別約束：前端不使用 Tailwind、前端 Axios 封裝統一錯誤處理、後端 Result 統一回傳格式、後端全域統一錯誤管理、串流採 SSE

---

## 1) 前端（Web Client）

### 核心技術（必用）
- **框架 / 建置**：Vue 3 + Vite
- **語言**：TypeScript
- **路由**：Vue Router
- **狀態管理**：Pinia
- **UI 元件庫**：Element Plus
- **樣式（不使用 Tailwind）**：SCSS +（CSS Modules 或 BEM 命名）
- **HTTP 請求**：Axios
  - Axios instance 封裝（baseURL/timeout/headers）
  - request/response interceptors（統一錯誤處理、401 行為）
- **串流顯示**：SSE（EventSource）
  -（備援可選）fetch ReadableStream
- **內容渲染**：Markdown-it（或 Marked）
- **程式碼高亮**：highlight.js（或 Shiki）
- **程式碼複製**：Clipboard API

### 品質與開發體驗（建議）
- **Lint/Format**：ESLint + Prettier
- **型別與工具**：Vue TSC（或 Volar）
- **測試（可選）**：Vitest + Vue Test Utils

---

## 2) 後端（API / Streaming Server）

### 核心技術（必用）
- **框架**：Spring Boot 3.x
- **語言 / 版本**：Java 17+（建議 Java 21）
- **Web**：Spring Web MVC
- **串流**：SseEmitter（SSE）
- **安全**：Spring Security + JWT
  - JWT 放 Cookie 或 Authorization Header（二選一，設計需一致）
- **資料存取**：Spring Data JPA + Hibernate
- **驗證**：Jakarta Bean Validation（@Valid）
- **序列化**：Jackson（可選 snake_case 策略）
- **統一回傳格式**：Result<T> Envelope（success/code/message/data/path/timestamp/traceId）
- **全域錯誤管理**：@RestControllerAdvice（GlobalExceptionHandler）
- **日誌**：SLF4J + Logback + MDC（TraceId）

### 文件與可觀測性（建議）
- **API 文件（可選）**：springdoc-openapi（Swagger UI）
- **DB Migration（強烈建議）**：Flyway（或 Liquibase）

---

## 3) 資料層與快取

### 核心（必用）
- **主資料庫**：MySQL 8

### 建議（可選）
- **Redis**：Rate limit / usage quota / session（若做 refresh token 或配額）

---

## 4) 模型層（LLM Gateway / Low Coupling 設計）

### 介面與分層（必用：架構模式）
- **Port/Adapter 架構**
  - `LlmClient`（介面）
  - `OpenAiLlmClient` / `AnthropicLlmClient` / `GeminiLlmClient`（Adapter，可替換）
- **PromptBuilder**：集中組 prompt，避免散落在 Controller/Service

### （A 版最小可用）
- 至少接入一個 LLM 供應商（透過後端呼叫，**前端不放 API Key**）

---

## 5) B 升級：RAG（文件問答＋引用）

> 只在升級 B 時導入，A 版不需上。

### 文件處理與儲存
- **檔案儲存**：S3 相容（AWS S3 / Cloudflare R2）或本機檔案系統
- **PDF 解析**：Apache PDFBox（Java）
- **Chunking**：自訂切分策略（字數/段落/頁碼）+ metadata（頁碼、段落索引）

### 向量檢索（Vector Store，擇一）
- **推薦 1：Qdrant**（獨立向量庫服務，容易部署）
- **推薦 2：PostgreSQL + pgvector**（需額外 DB）
- **推薦 3：Milvus / Pinecone**（更大型/託管方案）

### RAG 模組化設計（必用：架構模式）
- `Retriever`（介面）
- `IngestService`（解析/切塊/embedding）
- `CitationService`（引用格式化）
- `VectorStoreClient`（介面，支援替換向量庫）
- SSE 增加 `meta` 事件回傳 citations；同時寫入 `messages.metadata_json`

---

## 6) 部署與 DevOps（建議路線）

### MVP 可行（建議）
- **Docker + Docker Compose**：本機/測試/上線一致
- **Nginx**：反向代理（SSE 要注意 proxy buffering）
- **CI/CD**：GitHub Actions

### 部署環境（依需求選）
- **VM**：AWS EC2 / GCP VM（最直覺）
- （成長後可選）Cloud Run / ECS / Kubernetes

---

## 7) 安全與成本控制（專案必做項）
- **API Key 不落前端**：模型呼叫只能由後端發起
- **Rate limit（建議）**：避免濫用、控制成本（可用 Redis）
- **Usage 記錄（建議）**：記錄 input/output tokens（B/計費/配額必需）
- **檔案上傳限制（B）**：大小、mime、存取權限（必要時防毒掃描）

---

## 8) 一句話技術棧摘要（可放簡報）
Vue 3 + TypeScript + Element Plus（SCSS）前端，Axios 統一請求與錯誤處理；  
Spring Boot 3 + Spring Security(JWT) + MySQL 後端，Result 統一回傳與全域錯誤管理；  
SSE 串流實現 GPT-like 打字回覆，並以 LLM Gateway + Retriever 模組化設計支援升級 RAG。  
